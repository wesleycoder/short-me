#!/usr/bin/env zx
import "colors";
import "dotenv/config";
import task from "tasuku";

await task("Initialize husky", async () => {
  await $`husky_skip_init=1 . "${__dirname}/_/husky.sh"`;
});

task("Lint code", async () => {
  await $`npm run lint -- --fix`;
});

await task("Try to update DB types", async () => {
  const exitCode = await nothrow(
    $`npx openapi-typescript $NEXT_PUBLIC_SUPABASE_URL/rest/v1/?apikey=$NEXT_PUBLIC_SUPABASE_ANON_KEY --output types/database/index.ts`
  ).exitCode;

  console.log(`exitCode: ${exitCode}`.rainbow);
});

await task("Unit tests", async () => {
  await $`npm test`;
});
